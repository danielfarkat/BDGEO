# Lista 2 Banco de Dados

- Aluno: Daniel Farkat
- Matrícula: 166106/2024

## Questão 1:

Usando os scripts SQL do arquivo “lista_02_sql.sql”, crie as tabelas Instrutor, Aluno, Escola e Curso.

**Instrutor**

```
CREATE TABLE Instrutor (
InstrutorID INT NOT NULL,
CPF INT NOT NULL UNIQUE,
Nome VARCHAR( 30 ) NOT NULL,
Endereco VARCHAR( 60 ),
CONSTRAINT InstrutorPK PRIMARY KEY (InstrutorID)
);
```

![Exemplo de instrutores](instrutor.png)

**Aluno**

```
CREATE TABLE Aluno (
    AlunoID   		INT   			NOT NULL,
    CPF				INT				NOT NULL  UNIQUE,
    Nome  			VARCHAR( 30 )  	NOT NULL,
    Endereco   		VARCHAR( 60 ),
    CONSTRAINT AlunoPK PRIMARY KEY (AlunoID)
);
```

- Tive que alterar o tamanho da char para caber pessoas com nomes maiores e endereços grandes

```
ALTER table Aluno ALTER Column Nome TYPE VARCHAR(80);
ALTER table Aluno ALTER Column Endereco TYPE VARCHAR(150);
```

![Exemplo de Lista de alunos](aluno.png)

**Escola**

```
CREATE TABLE Escola (
    EscolaID   		INT   			NOT NULL,
    CNPJ			INT				NOT NULL  UNIQUE,
    Nome  			VARCHAR( 30 )  	NOT NULL,
    Endereco   		VARCHAR( 60 ),
    CONSTRAINT EscolaPK PRIMARY KEY (EscolaID)
);
```

![Exemplo de Lista de Escolas](escola.png)

**Curso**

```
CREATE TABLE Curso (
    CursoID   		INT   			NOT NULL,
    Nome  			VARCHAR( 30 )  	NOT NULL,
    Carga_horaria	INT 			NOT NULL,
    Ementa			VARCHAR( 500 )	,
    EscolaID        INT 			NOT NULL,

    CONSTRAINT CursoPK PRIMARY KEY (CursoID),

    CONSTRAINT CursoEscolaFK 	FOREIGN KEY (EscolaID)
    							REFERENCES Escola(EscolaID)
    							ON DELETE CASCADE
    							ON UPDATE CASCADE
);
```

![Exemplo de Curso](curso.png)

## Questão 2

**Turma**

```
CREATE TABLE Turma(
    TurmaID INT NOT NULL,
    CursoID INT NOT NULL,
    InstrutorID INT NOT NULL,
    DataInicio DATE,
    DataTermino DATE,

    PRIMARY KEY(TurmaID),

    CONSTRAINT CursoTurmaFK FOREIGN KEY (CursoID) REFERENCES Curso(CursoID)
                                ON DELETE CASCADE
                                ON UPDATE CASCADE,

    CONSTRAINT InstrutorTurmaFK FOREIGN KEY (InstrutorID) REFERENCES Instrutor(InstrutorID)
                                ON DELETE CASCADE
                                ON UPDATE CASCADE
);

```

![Exemplo de Turma](turma.png)

**Matrícula**

```
CREATE TABLE Matricula(
    TurmaID INT NOT NULL,
    AlunoID INT NOT NULL,
    Nota_final NUMERIC(4,2) NOT NULL,
    PRESENCA INT NOT NULL,

    PRIMARY KEY(TurmaID, AlunoID),

    CONSTRAINT MatriTurmaFK FOREIGN KEY (TURMAID) REFERENCES Turma(TurmaID),

    CONSTRAINT AlunoTurmaFK FOREIGN KEY (AlunoID) REFERENCES Aluno(AlunoID)
);
```

![Exemplo de Matrículas](Matricula.png)

## Questão 3

**Usando os scripts SQL do arquivo “lista_02_sql.sql”, insira os registros da tabela Instrutor. Ocorreu algum erro? Por que? Como resolver?**

Visto que a coluna _CPF_ é do tipo constraint.Foram colocados o mesmo valor para dois usuários diferentes do banco. Portanto apareceu um erro ao tentar colocar o mesmo _CPF_ para diferentes usuários. Dessa forma seria aconcelhado alterar o valor da coluna _CPF_ de _33333_ para o correto como por exemplo _44444_ como pode ser visto a baixo.

```
INSERT INTO Instrutor VALUES(3, 44444, 'Leandro Siqueira', 'Rua Nelson Davila, num 120, Centro');
```

![alt text](instrutor_4_users.png)

## Questão 4

**Usando os scripts SQL do arquivo “lista_02_sql.sql”, insira os registros da tabela Aluno. Ocorreu algum erro? Por que? Como resolver? Mostre o comando SQL para resolver o problema encontrado**

O erro foi quanto as dimensões das vorchars. Portanto, foram alteradas para dimensões consideradas mais corretas como pode ser visto a baixo:

```
ALTER table Aluno ALTER Column Nome TYPE VARCHAR(80);
ALTER table Aluno ALTER Column Endereco TYPE VARCHAR(150);
```

resultando no que pode ser visto na imagem

![Todos os usuários adicionados](All_users.png)

## Questão 5

**_Usando os scripts SQL do arquivo “lista_02_sql.sql”, insira os registros de
todas as outras tabelas._**

**Alunos**
![Adição de todos os alunos solicitados](todos_alunos.png)

**Curso**

![Adição de todos os alunos solicitados](Todos_cursos.png)

**Escolas**

![Adição de todas as escolas solicitadas](Todas_escolas.png)

**Instrutor**

![Adição de todos os instrutures](Instrutores.png)

**Matrícula**

![Adição de todas as matrículas](todas_matriculas.png)

**Turma**

![Adição de todas as Turmas](todas_turmas.png)

## Questão 6

o informentment schema tem os dados dos dados internos do banco de dados e o esquemas é uma classificação de tabela como por exemplo o privete que tem algumas senhas para acesso tabelas para uso interno e o public qie tem as tabelas criadas neste exercício;

- Quais esquemas existem nesse banco de dados?

Como estamos falando de algo interno ao sql é necessário retornar os dados de esquema do nosso banco;

![esses são os esquemas para gerar ](image-8.png)

- Recupere as informações sobre as tabelas do esquema “public"

![alt text](image-9.png)

- Recupere as informações sobre todas as colunas de todas as
  tabelas do esquema “public”.

```
SELECT * FROM INFORMATION_SCHEMA.COLUMNS where table_schema = 'public'
```

![`alt text`](image-10.png)

![alt text](image-11.png)

- Recupere as informações sobre todas as restrições (constraints) de
  todas as tabelas do esquema “public”.

```
SELECT * FROM INFORMATION_SCHEMA.TABLE_constraints WHERE table_schema = 'public'
```

![alt text](image-12.png)

## Questão 7

**_Selecione todos alunos ordenados pelo nome._**

**O código que tem que ser inserido é:**

```
SELECT * FROM aluno ORDER BY nome
```

![Alunos ordenados](Alunos_ordenados.png)

## Questão 8

**_Quantos cursos estão cadastrados no banco de dados?_**

**Podemos realizar essa questão com select count da seguinte forma**

```
SELECT COUNT (*) FROM curso
```

**Que resulta em:**

![lista de cursos](image-3.png)

**Prova Real**

![Prova Real](image-4.png)

## Questão 9

**_Quantos cursos foram ministrados pelo instrutor 'Leandro Siqueira'?_**

**Utilizando inner join e mostrando a soma**

```
select count(*) FROM turma inner join instrutor on turma.instrutorid=instrutor.instrutorid  WHERE instrutor.nome ='Leandro Siqueira'
```

![Somatório](image-5.png)

**Mostrando as colunas da tabela como prova real**

```
select * FROM turma as t inner join instrutor on turma.instrutorid=instrutor.instrutorid  WHERE i.nome ='Leandro Siqueira'
```

![Quantidade real](image-6.png)

## Questão 10

**Quantas horas de curso foram ministradas pelo instrutorLeandro Siqueira**

```
select sum(c.Carga_horaria)  from Curso as C, Instrutor as I, turma as t where t.instrutorid=i.instrutorid and c.cursoid=t.cursoid and i.nome='Leandro Siqueira'
```

**O somatório é de 840 horas**
![somatório de horas aulas ministradas](image-7.png)

## Questão 11

**Quantas turmas foram ministradas por cada instrutor?**

```
Select i.INSTRUTORID, SUM(I.INSTRUTORID)/ I.INSTRUTORID AS TURMAS_MINISTRADOS_POR_INSTRUTOR FROM Turma as t, Instrutor AS i, Curso AS c WHERE i.InstrutorID = t.InstrutorID AND c.CursoID = t.CursoID GROUP BY i.INSTRUTORID;
```

![alt text](image-13.png)

## Questão 12

**Quantas horas de curso foram ministradas por cada instrutor ?**

```
Select i.INSTRUTORID, SUM(C.carga_horaria) AS CARGAS_HORÁRIAS FROM Turma as t, Instrutor AS i, Curso AS c WHERE i.InstrutorID = t.InstrutorID AND c.CursoID = t.CursoID GROUP BY i.INSTRUTORID;
```

![alt text](image-15.png)

## Questão 13

**Se os cursos pagam 100,00 por hora ministrada, quanto cada instrutor recebeu por ano?**

```
Select i.INSTRUTORID, SUM(C.carga_horaria)*100 AS SALÁRIO FROM Turma as t, Instrutor AS i, Curso AS c WHERE i.InstrutorID = t.InstrutorID AND c.CursoID = t.CursoID GROUP BY i.INSTRUTORID;
```

![alt text](image-14.png)

## Questão 14

**Quais instrutores deram mais que 850 horas de curso?**

```
Select i.INSTRUTORID, SUM(C.carga_horaria) FROM Turma as t, Instrutor AS i, Curso AS c WHERE i.InstrutorID = t.InstrutorID AND c.CursoID = t.CursoID GROUP BY i.INSTRUTORID HAVING SUM(C.carga_horaria)>=850
```

![alt text](image-16.png)
